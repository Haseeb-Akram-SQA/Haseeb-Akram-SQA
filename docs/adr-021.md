# ADR-021: Establish Feature Flagging Strategy

Status: Accepted
Date: 2025-08-31

## Context
We need a safe and repeatable way to release features progressively, run A/B experiments, and quickly disable problematic changes without redeploying. Current deployments are all-or-nothing and increase risk during releases.

## Decision
Adopt feature flags for progressive delivery. For new user-facing features, wrap behavior behind a flag and roll out gradually by percentage and/or cohort. Centralize flag configuration and auditing.

## Drivers
- Reduce blast radius of releases
- Enable experimentation and targeted rollouts
- Provide rapid rollback without code reverts
- Improve observability of feature exposure

## Scope
- Application services: Web, API, and background workers
- Environments: Staging and Production
- Rollout controls: percentage-based, user/group targeting, and kill-switch

## Implementation outline
1. Introduce a feature flag SDK/library suitable for our stack.
2. Add a small abstraction to ensure consistent evaluation and defaulting.
3. Store flags centrally with audit trail and environment separation.
4. Instrument metrics and logs with flag exposure (flag, variant, request/user id).
5. Add CI checks to prevent permanent flags lingering beyond deprecation window.

## Security & compliance
- Flag configs are write-restricted and audited.
- PII is not stored in flag rules; only hashed identifiers or attributes.

## Risks & mitigations
- Risk: Flag sprawl and tech debt.
  - Mitigation: Add owner field, review in retrospectives, define sunset date.
- Risk: Performance overhead of flag checks.
  - Mitigation: Local caching, batched fetch, and circuit breakers.

## Alternatives considered
- Big-bang releases with blue/green only: less granular, still risky.
- Canary at infrastructure level only: helpful but lacks per-feature control.

## Consequences
- Small runtime cost for flag evaluation.
- Clearer release hygiene and safer deployments.
- Requires team discipline to remove flags after full rollout.

## Decision record
- ID: ADR-021
- Status: Accepted
- Owner: SRE/Platform in partnership with Feature Teams
- Review date: 2025-12-31
